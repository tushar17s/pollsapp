{% extends "index.html" %}
{% load static %}
{% block content %}
{% if request.user.is_authenticated %}
<div class="text-center my-4">
  <h2 class="fw-bold">Welcome to <span class="text-primary">PollsApp</span> ğŸ‘‹</h2>
  <p class="text-muted mb-0">
    Create polls, vote, and share your opinions.
  </p>
</div>
<hr>
{% else %}
<p class="text-center text-muted">
  <a href="{% url 'login' %}" class="text-primary fw-semibold">
    Login
  </a>
  or
  <a href="{% url 'signup' %}" class="text-success fw-semibold">
    Register
  </a>
  to vote and comment
</p>

<hr>
{% endif %}
{% if messages %}
{% for msg in messages %}
<div class="alert alert-danger text-center py-2 mb-2" role="alert">{{msg}}</div>
{% endfor %}
<script>
  setTimeout(() => {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => alert.remove());
  }, 3000);
</script>
{% endif %}
<div class="container my-4">

{% for poll in polls %}
{% if poll.id == hot_poll.id %}

  <div class="card-body">
    <span class="badge bg-danger">ğŸ”¥ Hot Poll</span>
  </div>

{% endif %}
<div class="card mb-4 shadow-sm position-relative">

{% if poll.id in voted_polls %}
  <span class="position-absolute top-0 end-0 badge bg-success m-2">
    Voted
  </span>
{% else %}
  <span class="position-absolute top-0 end-0 badge bg-secondary m-2">
    Not Voted
  </span>
{% endif %}

<br>
  <!-- ğŸ”¹ Card Header -->
  <div class="card-header text-muted">
    Poll created by <b>{{ poll.created_by }}</b>
    <span class="float-end">
      {{ poll.created_at }}
    </span>
  </div>

  <!-- ğŸ”¹ Card Body -->
  <div class="card-body">

    <h5 class="card-title">{{ poll.title }}</h5>

    <p class="card-text">
      {{ poll.description }}
    </p>

    <p class="text-secondary">
      <b>Category:</b> {{ poll.category }}
    </p>

    <!-- ğŸ”¹ Poll Options -->
<ul class="list-group list-group-flush mt-3">

{% for opt in poll.polloption_set.all %}
  <li class="list-group-item border-0 d-flex justify-content-center">

    <div class="card shadow-sm w-75">

      <div class="card-body py-2 px-3 text-center">

        {% if request.user.is_authenticated %}
          {% if not poll.id in voted_polls %}
            <a href="{% url 'voting' poll.id opt.id %}"
               class="stretched-link text-decoration-none small fw-semibold">
              {{ opt.option_text }}
            </a>
          {% else %}
            <span class="small text-muted fw-semibold">
              {{ opt.option_text }}
            </span>
          {% endif %}
        {% else %}
          <span class="small text-muted fw-semibold">
            {{ opt.option_text }}
          </span>
        {% endif %}

      </div>

    </div>

  </li>
{% endfor %}

</ul>


  </div>

  <!-- ğŸ”¹ Card Footer -->
  <div class="card-footer bg-light">

    {% if poll.id in voted_polls %}
     
      <div class="mt-2">
        <a href="{% url 'detail' poll.id %}" class="btn btn-sm btn-success">
          View Result
        </a>
        <a href="{% url 'undo' poll.id %}" class="btn btn-sm btn-success">
          Undo
        </a>
        <a href="{% url 'detail' poll.id %}" class="btn btn-sm btn-outline-secondary">
          View or Add Comment
        </a>
        {% if request.user == poll.created_by %}
        <a href="{% url 'delete_poll' poll.id %}" class="btn btn-sm btn-outline-danger">
          Delete Poll
        </a>
        {% endif %}
        
      </div>
    {% endif %}

  </div>

</div>

{% endfor %}

</div>

{% endblock content %}
{% comment %} 
ğŸ“ Interview-ready explanation
â€œI used Bootstrap flex utilities like d-flex, justify-content-center,
 and align-items-center to align interactive elements consistently without custom CSS.â€
â€œI used Bootstrap flex utilities and contextual components to visually differentiate interactive
 and non-interactive poll options without custom CSS.â€
 â€œI improved the login form UX using Bootstrapâ€™s grid, card, and utility classes without modifying
  the backend authentication logic.â€
  â€œI redesigned the signup form using Bootstrapâ€™s card, spacing utilities, and alert components while
   keeping the Django form handling unchanged.â€
â€œI improved the form usability using Bootstrap cards, spacing utilities, and form controls while keeping 
the original Django form handling intact.â€
â€œI redesigned the poll detail page using Bootstrapâ€™s grid and card components to separate concerns visually 
while keeping the existing Django data flow and Chart.js logic unchanged.â€
â€œI converted raw analytics data into a card-based dashboard using Bootstrapâ€™s grid system to improve readability
 and user experience without modifying backend logic.â€ 
â€œI optimized the option cards for compactness by adjusting
 Bootstrap spacing and typography utilities without custom CSS.â€

 I implemented a â€œhot pollâ€ feature by dynamically identifying the poll with the highest votes on the backend and 
 highlighting it on the home page, without creating a separate page or duplicating logic.

 I refined the hot poll logic by computing an engagement score using weighted ORM aggregation based on votes and comments, 
 allowing the most interactive poll to be highlighted dynamically without storing derived data.
 
{% endcomment %}